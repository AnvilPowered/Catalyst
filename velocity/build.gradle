plugins {
    id 'java'
    id 'com.github.johnrengelman.shadow' version '5.2.0'
}

group modGroup
version modVersion

sourceCompatibility = 1.8

repositories {
    mavenCentral()
    jcenter()
    maven { url "https://jitpack.io" }
    maven { url 'https://repo.velocitypowered.com/snapshots/' }
    maven { url 'https://repo.spongepowered.org/maven' }
}

dependencies {
    testCompile group: 'junit', name: 'junit', version: '4.12'
    implementation 'net.luckperms:api:5.0'
    compile 'com.velocitypowered:velocity-api:1.1.0-SNAPSHOT'
    annotationProcessor 'com.velocitypowered:velocity-api:1.1.0-SNAPSHOT'

    implementation project(':api')
    implementation project(':common')

    implementation project(':MSRepository:msr-api')
    implementation project(':MSRepository:msr-api:api-repository')
    implementation project(':MSRepository:msr-api:api-config')

    implementation project(':MSRepository:msr-common')
    implementation project(':MSRepository:msr-common:common-config')
    implementation project(':MSRepository:msr-common:common-repository')
    implementation project(':MSRepository:msr-velocity')
    implementation jsondb
    implementation guice
    implementation sponge
}

shadowJar {
    archiveName = "MSEssentials-Velocity-${modVersion}.jar"

    dependencies {
        include project(':api')
        include project(':common')
        include project(':MSRepository:msr-api')
        include project(':MSRepository:msr-api:api-config')
        include project(':MSRepository:msr-api:api-repository')
        include project(':MSRepository:msr-api:api-repository:api-repository-mongodb')

        include project(':MSRepository:msr-common')
        include project(':MSRepository:msr-common:common-config')
        include project(':MSRepository:msr-common:common-repository')
        include project(':MSRepository:msr-common:common-repository:common-repository-json')
        include project(':MSRepository:msr-common:common-repository:common-repository-mongodb')
        include project(':MSRepository:msr-common:common-repository:common-repository-nitrite')
        include project(':MSRepository:msr-sponge')
        include project(':MSRepository:msr-velocity')

        include dependency(jackson_annotations)
        include dependency(jackson_core)
        include dependency(jackson_databind)
        include dependency(jackson_datatype_jdk8)
        include dependency(jackson_datatype_jsr310)
        include dependency(jackson_module)
        include dependency(jasypt)
        include dependency(javasisst)
        include dependency(jsondb)
        include dependency(jxpath)
        include dependency(reflections)
        include dependency(mongo_java_driver)
        include dependency(mongodb_driver_sync)
        include dependency(morphia)

        relocate 'com.fasterxml', 'relocated.com.fasterxml'
        relocate 'org.reflections', 'relocated.org.reflections'
        relocate 'org.javassist', 'relocated.org.javassist'
        relocate 'org.objenesis', 'relocated.org.objenesis'
        relocate 'org.apache', 'relocated.org.apache'
        relocate 'org.bson', 'relocated.org.bson'
        relocate 'org.dizitart', 'relocated.org.dizitart'
        relocate 'org.h2', 'relocated.org.h2'
        relocate 'org.mongodb', 'relocated.org.mongodb'
        relocate 'com.mongodb', 'relocated.com.mongodb'
        relocate 'javassist', 'relocated.javassist'
        relocate 'okhttp3', 'relocated.okhttp3'
        relocate 'org.jasypt', 'relocated.org.jasypt'
    }
}
